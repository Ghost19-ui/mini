<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>For Kalpna (Minii) üíñ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg-main: #fef6ff;
      --bg-secondary: #ffeefc;
      --card: #ffffff;
      --accent: #ffb3c6;
      --accent-soft: #ffcfe5;
      --accent-alt: #bde0fe;
      --accent-green: #caffbf;
      --text-main: #43324f;
      --text-soft: #756586;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      min-height: 100vh;
      background: radial-gradient(circle at top, var(--bg-secondary), var(--bg-main) 45%, #e7f5ff);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px;
      overflow: hidden;
      position: relative;
    }

    .bg-orbit {
      position: fixed;
      inset: -20%;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255, 179, 198, 0.25) 0, transparent 45%),
        radial-gradient(circle at 90% 10%, rgba(189, 224, 254, 0.3) 0, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(202, 255, 191, 0.25) 0, transparent 50%),
        radial-gradient(circle at 15% 85%, rgba(255, 239, 214, 0.35) 0, transparent 55%);
      opacity: 0.9;
      z-index: -2;
    }

    .container {
      width: 100%;
      max-width: 950px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 24px;
      box-shadow: 0 22px 55px rgba(137, 92, 191, 0.35);
      padding: 20px 18px 22px;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(14px);
      border: 1px solid rgba(255, 255, 255, 0.85);
      z-index: 1;
    }

    @media (max-width: 768px) {
      .container {
        padding: 16px 12px 18px;
      }
    }

    header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 10px;
    }

    .avatar {
      width: 62px;
      height: 62px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #fff, var(--accent));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      animation: gentleBounce 3.5s ease-in-out infinite;
      box-shadow: 0 9px 22px rgba(255, 143, 178, 0.7);
      position: relative;
      overflow: hidden;
    }

    .avatar::after {
      content: "‚ú®";
      position: absolute;
      font-size: 18px;
      right: 4px;
      bottom: 4px;
    }

    @keyframes gentleBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    .title-block h1 {
      font-size: 1.6rem;
      margin-bottom: 4px;
    }

    .title-block p {
      font-size: 0.9rem;
      color: var(--text-soft);
    }

    .pill-main {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: linear-gradient(120deg, #ffc8dd, #bde0fe);
      color: #5b3e57;
      margin-top: 5px;
    }

    .step-indicator {
      position: absolute;
      right: 14px;
      top: 14px;
      display: flex;
      align-items: center;
      gap: 7px;
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .dots {
      display: flex;
      gap: 4px;
    }
    .dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #e3d8ff;
      opacity: 0.7;
      transition: transform 0.2s, opacity 0.2s, background 0.2s;
    }
    .dot.active {
      background: var(--accent);
      opacity: 1;
      transform: scale(1.25);
    }

    .steps-wrapper {
      margin-top: 10px;
      position: relative;
      height: 380px;
      max-height: 420px;
      overflow: hidden;
    }

    .step {
      position: absolute;
      inset: 0;
      padding: 10px 4px 4px;
      opacity: 0;
      transform: translateX(30px) scale(0.97);
      pointer-events: none;
      transition: opacity 0.35s ease, transform 0.35s ease;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .step.active {
      opacity: 1;
      transform: translateX(0) scale(1);
      pointer-events: auto;
    }

    .card {
      background: var(--card);
      border-radius: 20px;
      padding: 14px 14px 16px;
      box-shadow: 0 6px 18px rgba(207, 186, 243, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.95);
      position: relative;
      overflow: hidden;
    }

    .card h2 {
      font-size: 1rem;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .tag-soft {
      display: inline-flex;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(189, 224, 254, 0.6);
      font-size: 0.72rem;
      color: #28527a;
    }

    .tag-play {
      display: inline-flex;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(255, 209, 242, 0.7);
      font-size: 0.72rem;
      color: #8a355c;
    }

    .card small {
      font-size: 0.78rem;
      color: var(--text-soft);
      display: block;
      margin-bottom: 6px;
    }

    .big-text {
      font-size: 1.25rem;
      line-height: 1.3;
      margin-top: 4px;
    }

    .highlight {
      background: linear-gradient(120deg, var(--accent), #ffe5b4);
      -webkit-background-clip: text;
      color: transparent;
      font-weight: 700;
    }

    .soft-line {
      font-size: 0.9rem;
      margin-top: 4px;
    }

    .sub-note {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 6px;
    }

    .btn-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    button {
      border: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 0.8rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.2s;
      background: #eee;
    }

    .btn-main {
      background: linear-gradient(130deg, #ffb3c6, #ffafcc);
      color: #5a2643;
      box-shadow: 0 7px 16px rgba(255, 143, 178, 0.7);
    }
    .btn-main:hover { transform: translateY(-1px) scale(1.02); }

    .btn-ghost {
      background: rgba(189, 224, 254, 0.6);
      color: #274060;
      box-shadow: 0 4px 10px rgba(177, 208, 255, 0.7);
    }
    .btn-ghost:hover { transform: translateY(-1px); }

    .btn-next {
      margin-left: auto;
      background: linear-gradient(130deg, #caffbf, #bde0fe);
      color: #214f33;
      box-shadow: 0 7px 16px rgba(186, 255, 201, 0.7);
    }
    .btn-next:hover { transform: translateY(-1px) scale(1.02); }

    /* breathing bubble */
    .breath-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
    }

    .breath-circle {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      border: 3px dashed rgba(189, 224, 254, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .breath-core {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #ffffff, #bde0fe);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 0.82rem;
      padding: 8px;
      color: #214f60;
      animation: breathe 8s ease-in-out infinite;
    }

    .breath-aura {
      position: absolute;
      inset: -12px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(189, 224, 254, 0.7), transparent);
      opacity: 0.4;
      animation: aura 8s ease-in-out infinite;
    }

    @keyframes breathe {
      0%, 100% { transform: scale(0.86); }
      40% { transform: scale(1.05); }
      70% { transform: scale(0.9); }
    }

    @keyframes aura {
      0%, 100% { transform: scale(0.9); opacity: 0.3; }
      40% { transform: scale(1.08); opacity: 0.8; }
      70% { transform: scale(0.95); opacity: 0.45; }
    }

    .breath-text {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    /* meter */
    .meter {
      margin-top: 4px;
      background: #f7f0ff;
      border-radius: 999px;
      padding: 3px;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
    }
    .meter-bar {
      flex: 1;
      height: 8px;
      border-radius: 999px;
      background: #eadbff;
      overflow: hidden;
    }
    .meter-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(120deg, #caffbf, #bde0fe);
      width: 90%;
      box-shadow: 0 0 8px rgba(186, 255, 201, 0.8);
    }
    .meter-label { white-space: nowrap; color: #665483; }

    /* slider */
    .slider-wrap { margin-top: 8px; }
    .slider-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-bottom: 4px;
    }
    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #ffe5f0;
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #ffafcc;
      border: 2px solid #ffffff;
      box-shadow: 0 0 6px rgba(255, 143, 178, 0.8);
      cursor: pointer;
    }
    .slider-badge {
      margin-top: 3px;
      font-size: 0.8rem;
      padding: 3px 7px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: rgba(202, 255, 191, 0.9);
      color: #245631;
    }

    /* facts box */
    .fact-box {
      margin-top: 6px;
      padding: 9px 9px;
      border-radius: 12px;
      background: rgba(189, 224, 254, 0.8);
      font-size: 0.86rem;
      color: #133454;
      min-height: 46px;
    }

    .fact-counter {
      font-size: 0.74rem;
      color: var(--text-soft);
      margin-top: 4px;
    }

    /* final screen bits */
    .love-grid {
      margin-top: 6px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
      gap: 6px;
      font-size: 0.8rem;
    }
    .love-chip {
      border-radius: 12px;
      padding: 6px 8px;
      background: rgba(255, 239, 214, 0.9);
      color: #7a4b22;
      box-shadow: 0 3px 9px rgba(250, 204, 153, 0.7);
    }

    .footer-line {
      margin-top: 8px;
      text-align: center;
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    /* flower field */
    .flower-field {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: visible;
      z-index: 999;
    }

    .flower {
      position: absolute;
      width: 60px;
      height: 60px;
      transform-origin: center bottom;
      animation: flower-pop 1.4s ease-out forwards;
    }

    @keyframes flower-pop {
      0% { transform: translate(-50%, -10%) scale(0); opacity: 0; }
      40% { transform: translate(-50%, -20%) scale(1.05); opacity: 1; }
      100% { transform: translate(-50%, -30%) scale(0.95); opacity: 0; }
    }

    .flower-stem {
      position: absolute;
      bottom: -6px;
      left: 50%;
      width: 4px;
      height: 34px;
      border-radius: 999px;
      background: linear-gradient(to top, #18643a, #2e9e54);
      transform: translateX(-50%);
    }

    .flower-leaf {
      position: absolute;
      width: 16px;
      height: 10px;
      border-radius: 50% 50% 50% 0;
      background: #3ba262;
      top: 18px;
      transform-origin: left center;
    }

    .flower-leaf.right {
      left: 50%;
      transform: translateX(4px) rotate(40deg);
    }

    .flower-leaf.left {
      right: 50%;
      transform: translateX(-4px) rotate(-210deg);
    }

    .flower-center {
      position: absolute;
      top: 6px;
      left: 50%;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #fff7cc, #f3b34b);
      transform: translateX(-50%);
      box-shadow: 0 0 10px rgba(255, 220, 140, 0.8);
    }

    .petal {
      position: absolute;
      width: 16px;
      height: 26px;
      border-radius: 50%;
      transform-origin: bottom center;
      opacity: 0.9;
    }

    .petal-1 { top: -10px; left: 50%; transform: translateX(-50%) rotate(0deg); }
    .petal-2 { top: -6px; left: 50%; transform: translateX(-50%) rotate(60deg); }
    .petal-3 { top: -6px; left: 50%; transform: translateX(-50%) rotate(120deg); }
    .petal-4 { top: -2px; left: 50%; transform: translateX(-50%) rotate(180deg); }
    .petal-5 { top: -6px; left: 50%; transform: translateX(-50%) rotate(240deg); }
    .petal-6 { top: -6px; left: 50%; transform: translateX(-50%) rotate(300deg); }

    .petal.alt-shape {
      width: 20px;
      height: 22px;
      border-radius: 50% 50% 40% 40%;
    }

    /* magic popup instead of alert */
    .magic-popup-backdrop {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, rgba(0,0,0,0.45), rgba(0,0,0,0.7));
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
    }

    .magic-popup-backdrop.show {
      opacity: 1;
      pointer-events: auto;
    }

    .magic-popup {
      position: relative;
      max-width: 360px;
      width: 90%;
      background: radial-gradient(circle at top left, #fff7ff, #ffe4fb);
      border-radius: 22px;
      padding: 16px 16px 14px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.9);
      overflow: hidden;
      transform: scale(0.7) translateY(20px);
      opacity: 0;
      transition: transform 0.28s ease-out, opacity 0.28s ease-out;
    }

    .magic-popup-backdrop.show .magic-popup {
      transform: scale(1) translateY(0);
      opacity: 1;
    }

    .magic-sparkle {
      position: absolute;
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: radial-gradient(circle, #fff6bf, #ffc6ff);
      box-shadow: 0 0 10px rgba(255,230,160,0.8);
      animation: sparkle-fly 1.2s ease-out forwards;
      pointer-events: none;
    }

    @keyframes sparkle-fly {
      0% { transform: translate(0,0) scale(0); opacity: 0; }
      40% { transform: translate(-20px,-30px) scale(1); opacity: 1; }
      100% { transform: translate(20px,-60px) scale(0); opacity: 0; }
    }

    .magic-popup-title {
      font-size: 0.95rem;
      font-weight: 700;
      color: #7c3360;
      margin-bottom: 6px;
    }

    .magic-popup-text {
      font-size: 0.84rem;
      color: #5a476b;
      margin-bottom: 10px;
    }

    .magic-popup-btn {
      border: none;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 0.8rem;
      font-weight: 600;
      background: linear-gradient(130deg, #ffb3c6, #ffafcc);
      color: #5a2643;
      box-shadow: 0 7px 16px rgba(255, 143, 178, 0.7);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .magic-popup-btn:hover {
      transform: translateY(-1px) scale(1.02);
    }
  </style>
</head>
<body>
  <div class="bg-orbit"></div>
  <div class="flower-field" id="flowerField"></div>

  <!-- magic popup -->
  <div class="magic-popup-backdrop" id="magicPopupBackdrop">
    <div class="magic-popup">
      <div class="magic-popup-title" id="magicPopupTitle">little breathing tip ‚ú®</div>
      <div class="magic-popup-text" id="magicPopupText">
        Tiny trick, Kalpna: exhale a little slower than you inhale. It tells your body, ‚Äúwe are safe now.‚Äù
      </div>
      <button class="magic-popup-btn" id="magicPopupOk">
        ok, got it üí´
      </button>
    </div>
  </div>

  <div class="container" id="mainContainer">
    <header>
      <div class="avatar">üå∏</div>
      <div class="title-block">
        <h1>Hey, <span class="highlight">Kalpna (Minii)</span> üíï</h1>
        <p>This little space is just for you to breathe, smile, and remember you‚Äôre already enough.</p>
        <div class="pill-main">
          ‚òÄÔ∏è Sunday exam ‚Ä¢ Today‚Äôs mission: be kind to your brain, not harsh.
        </div>
      </div>
      <div class="step-indicator">
        <span id="stepLabel">step 1 / 5</span>
        <div class="dots">
          <div class="dot active"></div>
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      </div>
    </header>

    <div class="steps-wrapper">
      <!-- STEP 1 -->
      <section class="step active" data-step="1">
        <div class="card">
          <h2>soft welcome <span class="tag-soft">for Kalpna</span></h2>
          <small>read this slowly, like a friend holding your hand.</small>
          <div class="big-text">
            Hi <span class="highlight">Kalpna</span>, nothing you do today needs to be perfect.
            It only needs to be gentle.
          </div>
          <p class="soft-line">
            Your family, your friends, and one very proud person who made this page
            already adore you exactly as you are ‚Äì with or without a perfect score.
          </p>
          <p class="sub-note">
            Exams come and go. The way you care, try, and get back up ‚Äì that‚Äôs the part everyone loves about you.
          </p>
          <div class="btn-row">
            <button class="btn-main" id="step1TeaseBtn">
              üòº hey Minii, tap me
            </button>
            <button class="btn-next" data-next-step="2">
              okay, next üåà
            </button>
          </div>
        </div>
      </section>

      <!-- STEP 2 -->
      <section class="step" data-step="2">
        <div class="card">
          <h2>calm bubble <span class="tag-soft">for your nervous brain</span></h2>
          <small>follow the circle ‚Ä¢ 4s in ‚Ä¢ 4s hold ‚Ä¢ 4s out ‚Ä¢ repeat 3 times.</small>

          <div class="breath-wrap">
            <div class="breath-circle">
              <div class="breath-aura"></div>
              <div class="breath-core" id="breathCore">
                inhale‚Ä¶ hold‚Ä¶ exhale‚Ä¶ <br />you are safe, Minii.
              </div>
            </div>
            <p class="breath-text">
              notice your shoulders softening and your thoughts getting a little quieter.
            </p>
          </div>

          <div class="sub-note">
            Every slow breath is you telling your body: ‚ÄúIt‚Äôs okay, Kalpna. We‚Äôve got this.‚Äù
          </div>

          <div class="btn-row">
            <button class="btn-ghost" id="breathHintBtn">
              üí° little breathing tip
            </button>
            <button class="btn-next" data-next-step="3">
              okay, next üå±
            </button>
          </div>
        </div>
      </section>

      <!-- STEP 3 -->
      <section class="step" data-step="3">
        <div class="card">
          <h2>random wonder time <span class="tag-play">for curious Minii</span></h2>
          <small>new fact = small smile + brain break.</small>
          <div class="fact-box" id="factBox">
            Click ‚Äúnew random fact‚Äù to start.
          </div>
          <div class="fact-counter" id="factCounter">
            facts shown: 0 / 0
          </div>
          <p class="sub-note">
            Kalpna, even when you‚Äôre stressed about marks, the world is still full of tiny miracles ‚Äì and you‚Äôre one of them.
          </p>
          <div class="btn-row">
            <button class="btn-main" id="newFactBtn">
              ‚ú® new random fact
            </button>
            <button class="btn-ghost" id="resetFactsBtn">
              üîÅ reshuffle facts
            </button>
            <button class="btn-next" data-next-step="4">
              okay, next üí´
            </button>
          </div>
        </div>
      </section>

      <!-- STEP 4 -->
      <section class="step" data-step="4">
        <div class="card">
          <h2>how stormy is your mind? <span class="tag-play">honest Minii only</span></h2>
          <small>slide and see what your friendly page says back.</small>

          <div class="slider-wrap">
            <div class="slider-label">
              <span>0 = sleepy panda üêº</span>
              <span>10 = overthinking tornado üå™Ô∏è</span>
            </div>
            <input type="range" id="stressSlider" min="0" max="10" value="4" />
            <div class="slider-badge" id="stressBadge">
              üíå message: a little nervous is normal, it means you care.
            </div>
          </div>

          <div class="meter">
            <div class="meter-bar">
              <div class="meter-fill" id="prepFill"></div>
            </div>
            <span class="meter-label" id="prepLabel">prep level: 90%</span>
          </div>

          <p class="sub-note" id="prepNote">
            Reality check: you have put in real effort. Your brain has more saved than you think.
          </p>

          <div class="btn-row">
            <button class="btn-ghost" id="miniTeaseBtn">
              üôà Minii, stop scrolling past your greatness
            </button>
            <button class="btn-next" data-next-step="5">
              okay, next üå∏
            </button>
          </div>
        </div>
      </section>

      <!-- STEP 5 -->
      <section class="step" data-step="5">
        <div class="card">
          <h2>before Sunday‚Ä¶ <span class="tag-soft">read this, Kalpna</span></h2>
          <small>this part is the most important one.</small>

          <div class="big-text" id="finalBigText">
            No exam, no mark, no rank can change how loved you are.
          </div>
          <p class="soft-line">
            Your family, your friends, and the person who built this tiny universe
            are already proud of you for how seriously you‚Äôve tried.
          </p>

          <div class="love-grid">
            <div class="love-chip">
              üíõ family: ‚ÄúNo matter the result, you are our pride.‚Äù
            </div>
            <div class="love-chip">
              üíó friends: ‚ÄúWe love the way you laugh, not your marks.‚Äù
            </div>
            <div class="love-chip">
              üíñ from me to you: ‚ÄúMinii, you‚Äôre more magical than you realise.‚Äù
            </div>
          </div>

          <p class="sub-note" style="margin-top:7px;">
            Fun quiz: what matters more on Sunday?
          </p>
          <div class="btn-row">
            <button class="btn-ghost quiz-btn" data-answer="wrong">
              getting 100% perfect
            </button>
            <button class="btn-main quiz-btn" data-answer="right">
              staying calm and doing your honest best
            </button>
          </div>
          <p class="sub-note" id="quizResult" style="margin-top:6px;"></p>

          <div class="btn-row" style="margin-top:10px;">
            <button class="btn-ghost" id="restartBtn">
              üîÅ start again from step 1
            </button>
          </div>
        </div>
      </section>
    </div>

    <p class="footer-line">
      this page will always be on your side, Kalpna ‚Äì just like your people are, beyond any exam sheet.
    </p>
  </div>

  <script>
    // random pastel theme each visit
    function randomPastelHsl() {
      const hue = Math.floor(Math.random() * 360);
      const sat = 70;
      const light = 90;
      return `hsl(${hue}, ${sat}%, ${light}%)`;
    }

    (function applyRandomTheme() {
      const root = document.documentElement;
      const bg1 = randomPastelHsl();
      const bg2 = randomPastelHsl();
      root.style.setProperty("--bg-main", bg1);
      root.style.setProperty("--bg-secondary", bg2);
    })();

    // steps
    const steps = Array.from(document.querySelectorAll(".step"));
    const dots = Array.from(document.querySelectorAll(".dot"));
    const stepLabel = document.getElementById("stepLabel");
    let currentStep = 1;
    const totalSteps = steps.length;

    function updateStep(newStep) {
      currentStep = newStep;
      steps.forEach((s) => {
        const stepNum = parseInt(s.getAttribute("data-step"), 10);
        s.classList.toggle("active", stepNum === currentStep);
      });
      dots.forEach((d, idx) => {
        d.classList.toggle("active", idx + 1 === currentStep);
      });
      stepLabel.textContent = `step ${currentStep} / ${totalSteps}`;
    }

    document.querySelectorAll(".btn-next").forEach((btn) => {
      btn.addEventListener("click", () => {
        const next = parseInt(btn.getAttribute("data-next-step"), 10);
        updateStep(next);
      });
    });

    document.getElementById("restartBtn").addEventListener("click", () => {
      updateStep(1);
    });

    // magic popup
    const magicPopupBackdrop = document.getElementById("magicPopupBackdrop");
    const magicPopupTitle = document.getElementById("magicPopupTitle");
    const magicPopupText = document.getElementById("magicPopupText");
    const magicPopupOk = document.getElementById("magicPopupOk");

    function showMagicPopup(title, text) {
      magicPopupTitle.textContent = title;
      magicPopupText.textContent = text;
      magicPopupBackdrop.classList.add("show");

      const popup = magicPopupBackdrop.querySelector(".magic-popup");
      for (let i = 0; i < 6; i++) {
        const sp = document.createElement("div");
        sp.className = "magic-sparkle";
        sp.style.left = 50 + (Math.random() * 60 - 30) + "%";
        sp.style.bottom = "0";
        popup.appendChild(sp);
        setTimeout(() => sp.remove(), 1200);
      }
    }

    magicPopupOk.addEventListener("click", () => {
      magicPopupBackdrop.classList.remove("show");
    });
    magicPopupBackdrop.addEventListener("click", (e) => {
      if (e.target === magicPopupBackdrop) {
        magicPopupBackdrop.classList.remove("show");
      }
    });

    // teasing & breathing tip using popup
    const step1TeaseBtn = document.getElementById("step1TeaseBtn");
    const breathHintBtn = document.getElementById("breathHintBtn");

    step1TeaseBtn.addEventListener("click", () => {
      showMagicPopup(
        "psst, Minii üòº",
        "Serious question: who allowed you to be this hardworking AND this cute at the same time?"
      );
    });

    breathHintBtn.addEventListener("click", () => {
      showMagicPopup(
        "little breathing tip ‚ú®",
        "Tiny trick, Kalpna: exhale a little slower than you inhale. It tells your body, ‚Äúwe are safe now.‚Äù"
      );
    });

    // facts (no repeat until all shown)
    const factBox = document.getElementById("factBox");
    const factCounter = document.getElementById("factCounter");
    const newFactBtn = document.getElementById("newFactBtn");
    const resetFactsBtn = document.getElementById("resetFactsBtn");

    const allFacts = [
      "Koala fingerprints are so similar to humans that even forensic scientists have to look twice.",
      "Your brain uses about 20% of your body‚Äôs energy, even when you‚Äôre just sitting and daydreaming.",
      "Sea otters hold hands when they sleep so they don‚Äôt drift away from each other.",
      "There is a jellyfish species that can technically reverse its aging process and start over.",
      "When you smile, your brain quietly releases chemicals that make you feel a little calmer.",
      "Crows can remember human faces and even bring small ‚Äògifts‚Äô to people they like.",
      "Your heart beats a tiny bit faster when you see someone you care about walk into the room.",
      "Honey never spoils; jars from thousands of years ago are still okay to eat.",
      "When you study and then sleep, your brain is replaying and strengthening what you learned.",
      "Some flowers turn slightly toward gentle sounds, as if they‚Äôre listening to the world."
    ];

    let factQueue = [];
    let shownFacts = 0;

    function shuffleArray(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function initFacts() {
      factQueue = shuffleArray(allFacts);
      shownFacts = 0;
      factCounter.textContent = `facts shown: ${shownFacts} / ${allFacts.length}`;
      factBox.textContent = "Click ‚Äúnew random fact‚Äù to start.";
    }

    function showNextFact() {
      if (factQueue.length === 0) {
        factBox.textContent = "You‚Äôve seen all the facts, Minii! Hit reshuffle for a new order.";
        return;
      }
      const fact = factQueue.shift();
      shownFacts++;
      factBox.textContent = fact;
      factCounter.textContent = `facts shown: ${shownFacts} / ${allFacts.length}`;
      if (factQueue.length === 0) {
        factBox.textContent += "  (that was the last one in this round üåü)";
      }
    }

    newFactBtn.addEventListener("click", showNextFact);
    resetFactsBtn.addEventListener("click", initFacts);
    initFacts();

    // stress slider + meter
    const stressSlider = document.getElementById("stressSlider");
    const stressBadge = document.getElementById("stressBadge");
    const prepFill = document.getElementById("prepFill");
    const prepLabel = document.getElementById("prepLabel");
    const prepNote = document.getElementById("prepNote");

    function updateStress() {
      const v = parseInt(stressSlider.value, 10);
      let msg;
      if (v <= 3) {
        msg = "üíå message: calm is your superpower right now. Keep it soft, Kalpna.";
      } else if (v <= 7) {
        msg = "üåº message: nervous is okay, Minii. It just means you care ‚Äì not that you‚Äôre weak.";
      } else {
        msg = "üåô message: pause for 3 slow breaths. You are not alone in this; everyone who loves you is on your side.";
      }
      stressBadge.textContent = msg;

      const base = 0.78;
      const extra = Math.max(0, 0.15 - v * 0.01);
      const level = Math.min(0.97, base + extra);
      const percent = Math.round(level * 100);
      prepFill.style.width = percent + "%";
      prepLabel.textContent = "prep level: " + percent + "%";

      if (percent >= 92) {
        prepNote.textContent = "Reality check: you‚Äôve genuinely worked hard. This exam is just one snapshot of that, not the whole story.";
      } else {
        prepNote.textContent = "Even on days you felt slow, you still showed up. That steady effort is quietly on your side now.";
      }
    }

    stressSlider.addEventListener("input", updateStress);
    updateStress();

    const miniTeaseBtn = document.getElementById("miniTeaseBtn");
    miniTeaseBtn.addEventListener("click", () => {
      showMagicPopup(
        "hey overthinker üôà",
        "Minii, if overthinking burned calories, you‚Äôd never need cardio. For now, just drink some water and breathe. üíß"
      );
    });

    // quiz
    const quizButtons = document.querySelectorAll(".quiz-btn");
    const quizResult = document.getElementById("quizResult");

    quizButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const ans = btn.getAttribute("data-answer");
        if (ans === "right") {
          quizResult.textContent =
            "Exactly. A calm, kind-to-herself Kalpna will automatically remember more and write better. The rest will follow.";
        } else {
          quizResult.textContent =
            "Perfection is a myth. What really matters is that you breathe, read carefully, and give the exam your honest best.";
        }
      });
    });

    // click-to-grow flowers
    const flowerField = document.getElementById("flowerField");
    const mainContainer = document.getElementById("mainContainer");

    function randomPetalColor() {
      const palettes = [
        ["#ff9aa2", "#ffb7b2"],
        ["#b5ead7", "#c7ceea"],
        ["#ffdac1", "#ffb7b2"],
        ["#c7ceea", "#b5ead7"],
        ["#e2f0cb", "#ffb3c6"]
      ];
      const p = palettes[Math.floor(Math.random() * palettes.length)];
      return `radial-gradient(circle at 30% 15%, ${p[0]}, ${p[1]})`;
    }

    function createFlower(x, y) {
      const flower = document.createElement("div");
      flower.className = "flower";
      flower.style.left = x + "px";
      flower.style.top = y + "px";

      const stem = document.createElement("div");
      stem.className = "flower-stem";

      const leafLeft = document.createElement("div");
      leafLeft.className = "flower-leaf left";
      const leafRight = document.createElement("div");
      leafRight.className = "flower-leaf right";

      const center = document.createElement("div");
      center.className = "flower-center";

      const useAltShape = Math.random() > 0.5;

      for (let i = 1; i <= 6; i++) {
        const petal = document.createElement("div");
        petal.className = "petal petal-" + i;
        if (useAltShape) petal.classList.add("alt-shape");
        petal.style.backgroundImage = randomPetalColor();
        flower.appendChild(petal);
      }

      flower.appendChild(stem);
      flower.appendChild(leafLeft);
      flower.appendChild(leafRight);
      flower.appendChild(center);

      flowerField.appendChild(flower);

      setTimeout(() => {
        flower.remove();
      }, 1500);
    }

    function handleFlowerClick(e) {
      const rect = mainContainer.getBoundingClientRect();
      const x = e.clientX;
      const y = e.clientY;
      const withinX = x > rect.left && x < rect.right;
      const withinY = y > rect.top && y < rect.bottom;
      if (!withinX || !withinY) return;

      const target = e.target;
      if (target.tagName === "BUTTON" || target.tagName === "INPUT" || target.tagName === "TEXTAREA") {
        return;
      }

      createFlower(x, y);
    }

    document.addEventListener("click", handleFlowerClick);
  </script>
</body>
</html>
